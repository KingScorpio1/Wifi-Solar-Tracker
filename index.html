<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Solar Tracker Control Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 20px; background-color: #f8f9fa; }
        .container { max-width: 800px; margin: auto; }
        h1 { text-align: center; color: #343a40; margin-bottom: 30px; }
        .card { background: #ffffff; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .card h2 { margin-top: 0; color: #495057; border-bottom: 1px solid #e9ecef; padding-bottom: 10px; }
        .system-info { list-style: none; padding: 0; }
        .system-info li { padding: 5px 0; }
        .btn-grid { display: flex; flex-wrap: wrap; gap: 10px; }
        .btn { display: inline-block; padding: 10px 20px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px; border: none; cursor: pointer; font-size: 16px; }
        .btn:hover { background-color: #0056b3; }
        .btn-danger { background-color: #dc3545; }
        .btn-danger:hover { background-color: #c82333; }
    </style>
</head>
<body>
<div class="container">
    <h1>ðŸŒž Solar Tracker Control Hub ðŸŒž</h1>

    <div class="card">
        <h2>System Status</h2>
        <ul class="system-info">
            <li><strong>IP Address:</strong> <span id="ipAddress">-</span></li>
            <li><strong>Status:</strong> <span id="status">-</span></li>
            <li><strong>Position:</strong> <span id="position">-</span></li>
        </ul>
    </div>

    <div class="card">
        <h2>Control & Monitoring</h2>
        <div class="btn-grid">
            <a class="btn" href="/control">Control Panel</a>
            <a class="btn" href="/serial_monitor">Serial Monitor</a>
            <a class="btn" href="/history.html">History Chart</a>
        </div>
    </div>

    <div class="card">
        <h2>Configuration & Maintenance</h2>
        <div class="btn-grid">
            <a class="btn" href="/config">System Config</a>
            <a class="btn" href="/file_manager">File Manager</a>
            <a class="btn" href="/health.html">System Health</a>
            <a class="btn" href="/schedule.html">Event Scheduler</a>
            <a class="btn" href="/update">OTA Update</a>
            <a class="btn" href="/logs">System Logs</a>
            <button class="btn btn-danger" onclick="rebootSystem()">Reboot System</button>
        </div>
    </div>
</div>

<script>
    function rebootSystem() {
        if (confirm("Are you sure you want to reboot the system?")) {
            fetch('/api/reboot', { method: 'POST' })
                .then(response => response.text())
                .then(text => {
                    alert(text);
                    // The device will become unresponsive as it reboots.
                })
                .catch(error => {
                    alert("Failed to send reboot command.");
                });
        }
    }

    function updateStatus() {
        fetch('/api/status')
            .then(response => response.json())
            .then(data => {
                document.getElementById('ipAddress').textContent = data.ip;
                document.getElementById('status').textContent = data.isDayTracking ? 'Tracking' : 'Idle';
                document.getElementById('position').textContent = data.position + 'Â°';
            })
            .catch(error => console.error("Failed to fetch status."));
    }

    // Update status on page load and then every 5 seconds
    window.onload = function() {
        updateStatus();
        setInterval(updateStatus, 5000);
    };
</script>
</body>
</html>